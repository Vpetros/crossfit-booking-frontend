<div class="p-3">
  <div class="d-flex align-items-center justify-content-between mb-2">
    <div class="text-muted">
      Shows current and future reservations only.
    </div>

    <div class="d-flex gap-2">
      <button mat-stroked-button color="primary" (click)="loadAllBookings()">
        Load / Refresh
      </button>

      <button
        mat-stroked-button
        color="warn"
        (click)="clearPast()"
        [disabled]="bookings.length === 0"
      >
        Clear
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="d-flex flex-wrap gap-2 align-items-end mb-3">
    <mat-form-field appearance="outline">
      <mat-label>Search username</mat-label>
      <input matInput [(ngModel)]="filterUsername" placeholder="e.g. test6" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Date (YYYY-MM-DD)</mat-label>
      <input matInput [(ngModel)]="filterDate" placeholder="2026-01-10" />
    </mat-form-field>

    <div class="ms-auto text-muted small">
      Showing {{ filteredBookings.length }} of {{ bookings.length }}
    </div>
  </div>

  <div *ngIf="bookingsLoading" class="text-muted">Loading bookings…</div>

  <div *ngIf="!bookingsLoading && bookingsError" class="alert alert-danger">
    {{ bookingsError }}
  </div>

  <div *ngIf="!bookingsLoading && !bookingsError">
    <div *ngIf="bookings.length === 0" class="alert alert-secondary">
      No current/future bookings found.
    </div>

    <div *ngIf="bookings.length > 0 && filteredBookings.length === 0" class="alert alert-secondary">
      No results for the current filters.
    </div>

    <table
      mat-table
      [dataSource]="filteredBookings"
      class="mat-elevation-z1 w-100"
      *ngIf="filteredBookings.length > 0"
    >
      <ng-container matColumnDef="username">
        <th mat-header-cell *matHeaderCellDef>User</th>
        <td mat-cell *matCellDef="let b">{{ b.username || b.userId }}</td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let b">{{ b.date || 'Missing schedule' }}</td>
      </ng-container>

      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef>Time</th>
        <td mat-cell *matCellDef="let b">{{ formatTimeRange(b) }}</td>
      </ng-container>

      <!-- Past badge column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let b">
          <span
            class="badge text-bg-secondary"
            *ngIf="isPastReservation(b)"
            title="Past reservation"
          >
            PAST
          </span>
          <span class="text-muted" *ngIf="!isPastReservation(b)">—</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="timestamp">
        <th mat-header-cell *matHeaderCellDef>Booked at</th>
        <td mat-cell *matCellDef="let b">{{ formatTimestamp(b.timestamp) }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</div>